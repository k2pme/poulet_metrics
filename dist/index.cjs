"use strict";var C=Object.defineProperty;var ee=Object.getOwnPropertyDescriptor;var te=Object.getOwnPropertyNames;var ne=Object.prototype.hasOwnProperty;var oe=(e,t)=>{for(var n in t)C(e,n,{get:t[n],enumerable:!0})},ie=(e,t,n,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of te(t))!ne.call(e,i)&&i!==n&&C(e,i,{get:()=>t[i],enumerable:!(o=ee(t,i))||o.enumerable});return e};var re=e=>ie(C({},"__esModule",{value:!0}),e);var me={};oe(me,{_consentFlags:()=>ge,forgetMe:()=>ye,getSessionId:()=>fe,init:()=>le,reportBug:()=>X,setConsent:()=>ue,shutdown:()=>pe,trackEvent:()=>de});module.exports=re(me);var s=()=>Date.now();var S=(e,t,n)=>(e.addEventListener(t,n,{passive:!0}),()=>e.removeEventListener(t,n)),g=(e,t)=>(document.addEventListener(e,t,{passive:!0}),()=>document.removeEventListener(e,t));var E=(e,t=.1)=>{let n=e*t;return e+(Math.random()*2-1)*n},L=e=>{if(!e||typeof e!="object")return e;let t=["email","phone","password","ssn"],n=Array.isArray(e)?[]:{};for(let o of Object.keys(e)){if(t.includes(o.toLowerCase()))continue;let i=e[o];n[o]=typeof i=="object"?L(i):i}return n},f=(...e)=>{window.__POULET_DEBUG__&&console.log("[poulet]",...e)},B=e=>Uint8Array.from(atob(e),t=>t.charCodeAt(0));var M=Date.now(),T=[],O=()=>M,F=()=>{K();let e=()=>{M=Date.now()},t=g("mousemove",e),n=g("keydown",e),o=g("scroll",e),i=g("touchstart",e),c=S(window,"focus",e),y=S(window,"blur",e),_=S(document,"visibilitychange",e);T=[t,n,o,i,c,y,_]},K=()=>{T.forEach(e=>e()),T=[]};var u="poulet_leader_session",d=!1,R=e=>{let t=localStorage.getItem(u);return t?(d=t===e,d):(localStorage.setItem(u,e),d=!0,!0)},q=e=>{localStorage.getItem(u)===e&&localStorage.removeItem(u),d=!1};var H=(e,t)=>{let n=o=>{if(o.key!==u)return;let i=localStorage.getItem(u),c=i===e||!i;i?(d=i===e,t(d)):(localStorage.setItem(u,e),t(!0),d=!0)};return window.addEventListener("storage",n),()=>window.removeEventListener("storage",n)},k=()=>{var e;return{ua:navigator.userAgent,tz:(e=Intl.DateTimeFormat().resolvedOptions().timeZone)!=null?e:"UTC",dpr:window.devicePixelRatio||1}};var m=!1,D=!1,I="pending",z=!0,N=e=>{z=e},V=e=>{I=e,z&&typeof navigator!="undefined"&&navigator.doNotTrack==="1"&&(m=!1,D=!1,I="denied")},W=e=>{typeof e.analytics=="boolean"&&(m=e.analytics,I=m?"granted":"denied"),typeof e.replay=="boolean"&&(D=e.replay)},G=()=>({analytics:m,replay:D,state:I}),j=()=>m===!0;var p,x=[],U=!1;async function se(e){if(!(!p.hmacPublicKey||!("crypto"in window)))try{let t=B(p.hmacPublicKey),n=await crypto.subtle.importKey("raw",t,{name:"HMAC",hash:"SHA-256"},!1,["sign"]),o=await crypto.subtle.sign("HMAC",n,new TextEncoder().encode(e));return btoa(String.fromCharCode(...new Uint8Array(o)))}catch(t){return}}async function ae(e){let t=e.map(c=>L(c)),n=JSON.stringify({projectKey:p.projectKey,items:t}),o=await se(n);if(navigator.sendBeacon&&!p.debug){let c={type:"application/json"},y=new Blob([n],c);if(navigator.sendBeacon(p.endpoint+"/ingest",y))return!0}return(await fetch(p.endpoint+"/ingest",{method:"POST",headers:{"Content-Type":"application/json",...o?{"x-signature":o}:{}},body:n})).ok}function J(e){p=e,window.addEventListener("online",b),setInterval(b,5e3)}function l(e){x.push(e),x.length>=10&&b()}async function b(){if(!(U||x.length===0)){U=!0;try{let e=x.splice(0,20);await ae(e)||(x.unshift(...e),f("flush failed, will retry"))}catch(e){f("flush error",e)}finally{U=!1}}}var a,r=null,v=null,h,Y={projectKey:"",endpoint:"",consent:{default:"pending"},user:{},billing:{heartbeatSec:15,idleSec:60,maxHoursPerDay:6},privacy:{piiFilter:!0,dntRespect:!0,countryHint:"FR"},security:{hmacPublicKey:void 0},features:{bugReporter:!0,replay:!1,sentryBridge:!1},sampling:{heartbeats:1,events:1,bugs:1},debug:!1};function Z(e){a={...Y,...e,consent:{...Y.consent,...e.consent}},window.__POULET_DEBUG__=!!a.debug,J({endpoint:a.endpoint,projectKey:a.projectKey,hmacPublicKey:a.security.hmacPublicKey,debug:a.debug})}function P(){if(r)return;let e=crypto.randomUUID(),t=k();r={sessionId:e,startedAt:s(),lastActivityAt:s(),active:!0,leader:R(e)},h&&h(),h=H(e,o=>{r&&(r.leader=o)}),F();let n={type:"session.start",sessionId:e,ts:s(),projectKey:a.projectKey,ua:t.ua,tz:t.tz,dpr:t.dpr,consentFlags:{analytics:j(),replay:!1}};l(n),ce(),f("session opened",e)}function A(e){if(!r)return;Q(),K(),q(r.sessionId);let t={type:"session.end",sessionId:r.sessionId,ts:s(),reason:e};l(t),b(),h&&h(),r=null,f("session closed",e)}function ce(){Q();let e=()=>{if(!r||!j())return;let t=s()-O()>=a.billing.idleSec*1e3,n=document.visibilityState==="visible",o=n&&!t&&r.leader,i=k();if(Math.random()<=a.sampling.heartbeats&&o){let y={type:"heartbeat",sessionId:r.sessionId,ts:s(),active:!0,vis:n,idle:!1,jitter:Math.random(),ua:i.ua,tz:i.tz,dpr:i.dpr,purpose:"billing"};l(y)}let c=E(a.billing.heartbeatSec*1e3,.1);v=window.setTimeout(e,c)};v=window.setTimeout(e,E(a.billing.heartbeatSec*1e3,.1))}function Q(){v&&(clearTimeout(v),v=null)}var w=()=>{var e;return(e=r==null?void 0:r.sessionId)!=null?e:null};function X(e){let t=w();if(!t)return;let n={type:"bug",sessionId:t,ts:s(),title:e.title,description:e.description,severity:e.severity,hasCapture:!!(e.attachments&&e.attachments.length>0),purpose:"diagnostics"};l(n)}var $=!1;function le(e){var t,n,o,i;$||(N((n=(t=e.privacy)==null?void 0:t.dntRespect)!=null?n:!0),V((i=(o=e.consent)==null?void 0:o.default)!=null?i:"pending"),Z(e),document.visibilityState==="visible"&&P(),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&P()}),addEventListener("pagehide",()=>A("pagehide")),$=!0)}function ue(e){W(e),document.visibilityState==="visible"&&P()}function de(e,t){let n=w();if(!n)return;let o={type:"event",sessionId:n,ts:s(),name:e,props:t,purpose:"diagnostics"};l(o)}function pe(){A("shutdown")}function fe(){return w()}function ye(){A("shutdown")}var ge=G;0&&(module.exports={_consentFlags,forgetMe,getSessionId,init,reportBug,setConsent,shutdown,trackEvent});
//# sourceMappingURL=index.cjs.map
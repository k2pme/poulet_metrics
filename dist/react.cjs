'use strict';var react=require('react'),jsxRuntime=require('react/jsx-runtime');var s=()=>Date.now();var P=(e,t,n)=>(e.addEventListener(t,n,{passive:true}),()=>e.removeEventListener(t,n)),f=(e,t)=>(document.addEventListener(e,t,{passive:true}),()=>document.removeEventListener(e,t));var E=(e,t=.1)=>{let n=e*t;return e+(Math.random()*2-1)*n},I=e=>{if(!e||typeof e!="object")return e;let t=["email","phone","password","ssn"],n=Array.isArray(e)?[]:{};for(let o of Object.keys(e)){if(t.includes(o.toLowerCase()))continue;let i=e[o];n[o]=typeof i=="object"?I(i):i;}return n},y=(...e)=>{window.__POULET_DEBUG__&&console.log("[poulet]",...e);},O=e=>Uint8Array.from(atob(e),t=>t.charCodeAt(0));var F=Date.now(),A=[],q=()=>F,H=()=>{L();let e=()=>{F=Date.now();},t=f("mousemove",e),n=f("keydown",e),o=f("scroll",e),i=f("touchstart",e),c=P(window,"focus",e),g=P(window,"blur",e),_=f("visibilitychange",e);A=[t,n,o,i,c,g,_];},L=()=>{A.forEach(e=>e()),A=[];};var u="poulet_leader_session",d=false,z=e=>{let t=localStorage.getItem(u);return t?(d=t===e,d):(localStorage.setItem(u,e),d=true,true)},N=e=>{localStorage.getItem(u)===e&&localStorage.removeItem(u),d=false;};var V=(e,t)=>{let n=o=>{if(o.key!==u)return;let i=localStorage.getItem(u);i?(d=i===e,t(d)):(localStorage.setItem(u,e),t(true),d=true);};return window.addEventListener("storage",n),()=>window.removeEventListener("storage",n)},T=()=>{var e;return {ua:navigator.userAgent,tz:(e=Intl.DateTimeFormat().resolvedOptions().timeZone)!=null?e:"UTC",dpr:window.devicePixelRatio||1}};var w=false,G=true,J=e=>{G=e;},Y=e=>{G&&typeof navigator!="undefined"&&navigator.doNotTrack==="1"&&(w=false,"denied");},Z=e=>{typeof e.analytics=="boolean"&&(w=e.analytics,w?"granted":"denied"),typeof e.replay=="boolean"&&(e.replay);};var K=()=>w===true;var p,m=[],D=false;async function ie(e){if(!(!p.hmacPublicKey||!("crypto"in window)))try{let t=O(p.hmacPublicKey),n=await crypto.subtle.importKey("raw",t,{name:"HMAC",hash:"SHA-256"},!1,["sign"]),o=await crypto.subtle.sign("HMAC",n,new TextEncoder().encode(e));return btoa(String.fromCharCode(...new Uint8Array(o)))}catch(t){return}}async function re(e){let t=e.map(c=>I(c)),n=JSON.stringify({projectKey:p.projectKey,items:t}),o=await ie(n);if(navigator.sendBeacon&&!p.debug){let c={type:"application/json"},g=new Blob([n],c);if(navigator.sendBeacon(p.endpoint+"/ingest",g))return  true}return (await fetch(p.endpoint+"/ingest",{method:"POST",headers:{"Content-Type":"application/json",...o?{"x-signature":o}:{}},body:n})).ok}function Q(e){p=e,window.addEventListener("online",x),setInterval(x,5e3);}function l(e){m.push(e),m.length>=10&&x();}async function x(){if(!(D||m.length===0)){D=true;try{let e=m.splice(0,20);await re(e)||(m.unshift(...e),y("flush failed, will retry"));}catch(e){y("flush error",e);}finally{D=false;}}}var a,r=null,b=null,v,X={projectKey:"",endpoint:"",consent:{default:"pending"},user:{},billing:{heartbeatSec:15,idleSec:60,maxHoursPerDay:6},privacy:{piiFilter:true,dntRespect:true,countryHint:"FR"},security:{hmacPublicKey:void 0},features:{bugReporter:true,replay:false,sentryBridge:false},sampling:{heartbeats:1,events:1,bugs:1},debug:false};function $(e){a={...X,...e,consent:{...X.consent,...e.consent}},window.__POULET_DEBUG__=!!a.debug,Q({endpoint:a.endpoint,projectKey:a.projectKey,hmacPublicKey:a.security.hmacPublicKey,debug:a.debug});}function S(){if(r)return;let e=crypto.randomUUID(),t=T();r={sessionId:e,startedAt:s(),lastActivityAt:s(),active:true,leader:z(e)},v&&v(),v=V(e,o=>{r&&(r.leader=o);}),H();let n={type:"session.start",sessionId:e,ts:s(),projectKey:a.projectKey,ua:t.ua,tz:t.tz,dpr:t.dpr,consentFlags:{analytics:K(),replay:false}};l(n),se(),y("session opened",e);}function j(e){if(!r)return;ee(),L(),N(r.sessionId);let t={type:"session.end",sessionId:r.sessionId,ts:s(),reason:e};l(t),x(),v&&v(),r=null,y("session closed",e);}function se(){ee();let e=()=>{if(!r||!K())return;let t=s()-q()>=a.billing.idleSec*1e3,n=document.visibilityState==="visible",o=n&&!t&&r.leader,i=T();if(Math.random()<=a.sampling.heartbeats&&o){let g={type:"heartbeat",sessionId:r.sessionId,ts:s(),active:true,vis:n,idle:false,jitter:Math.random(),ua:i.ua,tz:i.tz,dpr:i.dpr,purpose:"billing"};l(g);}let c=E(a.billing.heartbeatSec*1e3,.1);b=window.setTimeout(e,c);};b=window.setTimeout(e,E(a.billing.heartbeatSec*1e3,.1));}function ee(){b&&(clearTimeout(b),b=null);}var h=()=>{var e;return (e=r==null?void 0:r.sessionId)!=null?e:null};function C(e){let t=h();if(!t)return;let n={type:"bug",sessionId:t,ts:s(),title:e.title,description:e.description,severity:e.severity,hasCapture:!!(e.attachments&&e.attachments.length>0),purpose:"diagnostics"};l(n);}var te=false;function ne(e){var t,n,o,i;te||(J((n=(t=e.privacy)==null?void 0:t.dntRespect)!=null?n:true),Y((i=(o=e.consent)==null?void 0:o.default)!=null?i:"pending"),$(e),document.visibilityState==="visible"&&S(),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&S();}),addEventListener("pagehide",()=>j("pagehide")),te=true);}function M(e){Z(e),document.visibilityState==="visible"&&S();}function B(e,t){let n=h();if(!n)return;let o={type:"event",sessionId:n,ts:s(),name:e,props:t,purpose:"diagnostics"};l(o);}function R(){j("shutdown");}function U(){return h()}var oe=react.createContext({trackEvent:B,reportBug:C,setConsent:M,shutdown:R,getSessionId:U}),ze=({config:e,children:t})=>(react.useEffect(()=>{ne(e);},[]),jsxRuntime.jsx(oe.Provider,{value:{trackEvent:B,reportBug:C,setConsent:M,shutdown:R,getSessionId:U},children:t})),Ne=()=>react.useContext(oe);exports.MetricsProvider=ze;exports.useMetrics=Ne;//# sourceMappingURL=react.cjs.map
//# sourceMappingURL=react.cjs.map